<!DOCTYPE html>
<html lang="ja">
<head>
	<%- include('../parts/head', {title: '管理者ページ'}) %>
	<style>
		body {
			background-color: #f8f9fa;
			min-height: 100vh;
		}
	</style>
</head>
<body>
	<div class="container py-5">
		<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-4">
			<div>
				<h1 class="h3 fw-bold mb-1">管理者ページ</h1>
				<p class="text-muted mb-0">管理者専用機能は順次ここに追加されます。</p>
			</div>
			<button class="btn btn-outline-secondary" id="logout-button">ログアウト</button>
		</div>

		<div class="row g-4">
			<div class="col-12 col-lg-4">
				<div class="card shadow-sm h-100">
					<div class="card-body">
						<h2 class="h5 mb-3">現在のユーザー</h2>
						<dl class="mb-0">
							<dt class="text-muted small">メールアドレス</dt>
							<dd class="fs-5 mb-3"><%= user.email || '未設定' %></dd>
							<dt class="text-muted small">UID</dt>
							<dd class="text-break mb-3"><code><%= user.uid %></code></dd>
							<dt class="text-muted small">最終ログイン</dt>
							<dd class="mb-0"><%= (user.metadata && user.metadata.lastSignInTime) ? user.metadata.lastSignInTime : '情報なし' %></dd>
						</dl>
					</div>
				</div>
			</div>
			<div class="col-12 col-lg-8">
				<div class="card shadow-sm h-100">
					<div class="card-body">
						<h2 class="h5 mb-3">管理機能</h2>
						<p class="text-muted">必要な機能が決まり次第、このリストに追加していきます。</p>
						<div class="list-group">
							<a href="/admin/bulk-mail" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
								<div>
									<div class="fw-bold">一斉メール送信</div>
									<small class="text-muted">改行区切りの宛先へSendGrid経由で同じ本文を配信します。</small>
								</div>
								<i class="bi bi-chevron-right"></i>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="alert alert-danger d-none mt-4" id="logout-error" role="alert"></div>
	</div>

	<script>
		(function() {
			const logoutButton = document.getElementById('logout-button');
			const errorBox = document.getElementById('logout-error');

			function showError(message) {
				errorBox.textContent = message;
				errorBox.classList.remove('d-none');
			}

			logoutButton.addEventListener('click', async (event) => {
				event.preventDefault();
				errorBox.classList.add('d-none');
				logoutButton.disabled = true;
				const defaultLabel = 'ログアウト';
				logoutButton.textContent = 'ログアウト中...';

				try {
					const response = await fetch('/admin/logout', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
					});

					if (!response.ok) {
						throw new Error('ログアウトに失敗しました。');
					}

					window.location.href = '/admin';
				} catch (error) {
					showError(error.message || 'ログアウト処理に失敗しました。');
					logoutButton.disabled = false;
					logoutButton.textContent = defaultLabel;
				}
			});
		})();
	</script>
</body>
</html>
